#!/bin/sh
set -eu

PREFIX=http://w3id.org/dice-research/enexa/module/dice-embeddings/

echo ./main.py \
    --batch_size=32 \
    --embedding_dim="$(enexa-parameter "${PREFIX}parameter/embedding_dim")" \
    --eval_model None \
    --model="$(enexa-parameter "${PREFIX}parameter/model")" \
    --num_epochs="$(enexa-parameter "${PREFIX}parameter/num_epochs")" \
    --path_single_kg="$(enexa-parameter "${PREFIX}parameter/path_single_kg")" \
    --save_embeddings_as_csv \
    --storage_path="$ENEXA_MODULE_INSTANCE_DIRECTORY"

./main.py \
    --batch_size="$(enexa-parameter "${PREFIX}parameter/batch_size")" \
    --embedding_dim="$(enexa-parameter "${PREFIX}parameter/embedding_dim")" \
    --eval_model None \
    --model="$(enexa-parameter "${PREFIX}parameter/model")" \
    --num_epochs="$(enexa-parameter "${PREFIX}parameter/num_epochs")" \
    --path_single_kg="$(enexa-parameter "${PREFIX}parameter/path_single_kg")" \
    --save_embeddings_as_csv \
    --storage_path="$ENEXA_MODULE_INSTANCE_DIRECTORY"

enexa-add-file "$ENEXA_MODULE_INSTANCE_DIRECTORY"/configuration.json
enexa-add-file "$ENEXA_MODULE_INSTANCE_DIRECTORY"/epoch_losses.csv
enexa-add-file "$ENEXA_MODULE_INSTANCE_DIRECTORY"/eval_report.json
enexa-add-file "$ENEXA_MODULE_INSTANCE_DIRECTORY"/model.pt "${PREFIX}result/model.pt"
enexa-add-file "$ENEXA_MODULE_INSTANCE_DIRECTORY"/report.json
enexa-add-file "$ENEXA_MODULE_INSTANCE_DIRECTORY"/*_entity_embeddings.csv "${PREFIX}result/entity_embeddings.csv"
